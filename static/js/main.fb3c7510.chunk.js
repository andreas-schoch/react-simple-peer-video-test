(this["webpackJsonpreact-simple-peer-video-stream-test"]=this["webpackJsonpreact-simple-peer-video-stream-test"]||[]).push([[0],{11:function(e,t,n){e.exports={wrapper:"VideoPeerJS_wrapper__3u3HX",left:"VideoPeerJS_left__hnH5B",video:"VideoPeerJS_video__r8XjV",right:"VideoPeerJS_right__2-PzP",form:"VideoPeerJS_form__22L_T"}},3:function(e,t,n){e.exports={wrapper:"VideoVanillaWebRTC_wrapper__1kCWV",left:"VideoVanillaWebRTC_left__1CdJA",video:"VideoVanillaWebRTC_video__2JcOX",right:"VideoVanillaWebRTC_right__1B0SI",form:"VideoVanillaWebRTC_form__38NYA",description:"VideoVanillaWebRTC_description__tbcsR",descriptionLabel:"VideoVanillaWebRTC_descriptionLabel__3d1md",descriptionTextarea:"VideoVanillaWebRTC_descriptionTextarea__3t_tp",iceCandidates:"VideoVanillaWebRTC_iceCandidates__22Kuj",iceCandidatesLabel:"VideoVanillaWebRTC_iceCandidatesLabel__3-lB8",iceCandidatesTextarea:"VideoVanillaWebRTC_iceCandidatesTextarea__26tsd"}},41:function(e,t,n){e.exports=n(85)},46:function(e,t,n){},7:function(e,t,n){e.exports={wrapper:"VideoSimplePeer_wrapper__1POsX",left:"VideoSimplePeer_left__1Xu1L",video:"VideoSimplePeer_video__2iJoo",right:"VideoSimplePeer_right__18nVu",form:"VideoSimplePeer_form__KoPlx"}},70:function(e,t){},72:function(e,t){},80:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=80},85:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(37),o=n.n(r),l=(n(46),n(21)),i=n(10),s=n(9),u=n(18),m=n(8),d=n.n(m),f=n(1),p=n(7),b=n.n(p),E=n(24),g=n.n(E),v=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=Object(a.useState)(null),r=Object(f.a)(n,2),o=r[0],l=r[1],i=Object(a.useState)(null),m=Object(f.a)(i,2),p=m[0],E=m[1],v=Object(a.useState)(null),O=Object(f.a)(v,2),h=O[0],S=O[1],C=Object(a.useState)(!1),j=Object(f.a)(C,2),_=j[0],w=j[1],y=Object(a.useState)(_?"PEER 1":"PEER 2"),N=Object(f.a)(y,1)[0],P=Object(a.useState)({connectData:"",message:""}),R=Object(f.a)(P,2),V=R[0],T=R[1];Object(a.useEffect)((function(){e.current&&p&&(e.current.srcObject=p,e.current.oncanplay=function(){e.current.play(),e.current.muted=!0})}),[p]),Object(a.useEffect)((function(){t.current&&h&&(t.current.srcObject=h,t.current.oncanplay=function(){t.current.play(),t.current.muted=!1})}),[h]),Object(a.useEffect)((function(){console.log("Peer",o),o&&(o.on("error",(function(e){return console.error("error",e)})),o.on("signal",(function(e){"offer"!==e.type&&"answer"!==e.type||(console.log("%c ".concat(JSON.stringify(e)),"background: #222; color: #bada55"),alert("open console and copy the console.log with the black background. Give it to the other peer to connect"))})),o.on("connect",(function(){console.log("CONNECT")})),o.on("data",(function(e){var t=JSON.parse(e);console.log("parsed",t),t.message&&console.log("%c MESSAGE - ".concat(t.message.author,': "').concat(t.message.text,'"'),"background: black; color: white; padding: 1rem")})),o.on("stream",(function(e){S(e)})))}),[o]);var x=function(e){return T(Object(u.a)({},V,Object(s.a)({},e.target.name,e.target.value)))};return c.a.createElement("div",{className:b.a.wrapper},c.a.createElement("div",{className:b.a.left},c.a.createElement("h2",null,"My Stream"),c.a.createElement("video",{ref:e,className:b.a.video}),c.a.createElement("h2",null,"Remote Stream"),c.a.createElement("video",{ref:t,className:b.a.video})),c.a.createElement("div",{className:b.a.right},c.a.createElement("button",{onClick:function(){return w(!_)}},_?"Change to receiving Peer":"Change to Initializing Peer"),c.a.createElement("button",{onClick:function(e){return function(){var e;return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d.a.awrap(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}));case 3:e=t.sent,E(e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error('stream couldnt be started via "startStream()"',t.t0);case 10:case"end":return t.stop()}}),null,null,[[0,7]])}()}},"Start My Stream"),c.a.createElement("button",{onClick:function(e){l(new g.a({initiator:_,trickle:!1,stream:p}))}},"Init This Peer ".concat(_?"(Generates Offer)":"")),c.a.createElement("form",{onSubmit:function(e){e.preventDefault(),o.signal(JSON.parse(V.connectData))},className:[b.a.form,b.a.connectForm].join(" ")},c.a.createElement("fieldset",null,c.a.createElement("legend",null,"Connect"),c.a.createElement("textarea",{name:"connectData",id:"connectData",onChange:x,value:V.connectData,placeholder:"".concat(_?"Enter Answer":"Enter Offer"," of other Peer")}),c.a.createElement("button",{type:"submit"},"connect ",_?"":"(Generates Answer)"))),c.a.createElement("form",{onSubmit:function(e){e.preventDefault(),console.log("sending message"),function(){if(o){var e={author:N,text:V.message};o.send(JSON.stringify({message:e}))}}()},className:[b.a.form,b.a.sendMessageForm].join(" ")},c.a.createElement("fieldset",null,c.a.createElement("legend",null,"Send Message to Peer"),c.a.createElement("input",{type:"text","aria-label":"chat input",name:"message",value:V.message,onChange:x,placeholder:"Hello Peer..."}),c.a.createElement("button",{type:"submit"},"send")))))},O=n(11),h=n.n(O),S=n(38),C=n.n(S),j=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=Object(a.useState)(null),r=Object(f.a)(n,2),o=r[0],l=r[1],i=Object(a.useState)(null),m=Object(f.a)(i,2),p=m[0],b=m[1],E=Object(a.useState)(null),g=Object(f.a)(E,2),v=g[0],O=g[1],S=Object(a.useState)(null),j=Object(f.a)(S,2),_=j[0],w=j[1],y=Object(a.useState)(null),N=Object(f.a)(y,2),P=N[0],R=N[1],V=Object(a.useState)({connectData:"",message:""}),T=Object(f.a)(V,2),x=T[0],D=T[1];Object(a.useEffect)((function(){e.current&&_&&(e.current.srcObject=_,e.current.oncanplay=function(){e.current.play(),e.current.muted=!0})}),[_]),Object(a.useEffect)((function(){t.current&&P&&(t.current.srcObject=P,t.current.oncanplay=function(){t.current.play(),t.current.muted=!1})}),[P]),Object(a.useEffect)((function(){o&&(o.on("open",(function(e){console.log("My peer ID is: "+e),console.log("PEERr",o)})),o.on("connection",(function(e){console.log("connection",e),b(e)})),o.on("call",(function(e){console.log("incoming call. Answering automatically"),O(e),e.answer(_)})))}),[o]),Object(a.useEffect)((function(){p&&(console.log("CONNECTION ESTABLISHED"),p.on("open",(function(){p.on("data",(function(e){var t=JSON.parse(e);console.log("parsed",t),t.message&&console.log("%c MESSAGE - ".concat(t.message.author,': "').concat(t.message.text,'"'),"background: black; color: white; padding: 1rem")}))})))}),[p]),Object(a.useEffect)((function(){v&&v.on("stream",(function(e){R(e)}))}),[v]);var k=function(e){return D(Object(u.a)({},x,Object(s.a)({},e.target.name,e.target.value)))};return c.a.createElement("div",{className:h.a.wrapper},c.a.createElement("div",{className:h.a.left},c.a.createElement("h2",null,"My Stream"),c.a.createElement("video",{ref:e,className:h.a.video}),c.a.createElement("h2",null,"Remote Stream"),c.a.createElement("video",{ref:t,className:h.a.video})),c.a.createElement("div",{className:h.a.right},c.a.createElement("button",{onClick:function(e){return function(){var e;return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d.a.awrap(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}));case 3:e=t.sent,w(e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error('stream couldnt be started via "startStream()"',t.t0);case 10:case"end":return t.stop()}}),null,null,[[0,7]])}()}},"Start My Stream"),c.a.createElement("button",{onClick:function(e){l(new C.a({debug:!0,config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}}))}},"Init This Peer"),c.a.createElement("form",{onSubmit:function(e){e.preventDefault(),b(o.connect(x.connectData))},className:h.a.form},c.a.createElement("fieldset",null,c.a.createElement("legend",null,"Connect"),c.a.createElement("input",{type:"text",name:"connectData",id:"connectData",onChange:k,value:x.connectData,placeholder:"enter peer id you want to connect with"}),c.a.createElement("button",{type:"submit"},"connect"))),c.a.createElement("form",{onSubmit:function(e){e.preventDefault(),function(){if(o&&p){var e={author:"derp",text:x.message};p.send(JSON.stringify({message:e})),console.log("sending message")}}()},className:h.a.form},c.a.createElement("fieldset",null,c.a.createElement("legend",null,"Send Message to Peer"),c.a.createElement("input",{type:"text","aria-label":"chat input",name:"message",value:x.message,onChange:k,placeholder:"Hello Peer..."}),c.a.createElement("button",{type:"submit"},"send"))),c.a.createElement("button",{onClick:function(e){var t;t=x.connectData,o&&p&&_&&O(o.call(t,_))}},"CALL")))},_=n(3),w=n.n(_),y=[],N=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=Object(a.useRef)(null),r=Object(a.useRef)(null),o=Object(a.useState)(null),l=Object(f.a)(o,2),i=l[0],m=l[1],p=Object(a.useState)(null),b=Object(f.a)(p,2),E=b[0],g=b[1],v=Object(a.useState)(null),O=Object(f.a)(v,2),h=O[0],S=O[1],C=Object(a.useState)(!1),j=Object(f.a)(C,2),_=j[0],N=j[1],P=Object(a.useState)({description:"",message:"",remoteIceCandidates:""}),R=Object(f.a)(P,2),V=R[0],T=R[1];Object(a.useEffect)((function(){n.current&&i&&(n.current.srcObject=i,n.current.oncanplay=function(){n.current.play(),n.current.muted=!0})}),[i]),Object(a.useEffect)((function(){r.current&&E&&(r.current.srcObject=E,r.current.oncanplay=function(){r.current.play(),r.current.muted=!1})}),[E]),Object(a.useEffect)((function(){if(h&&(console.log("useEffect - localPeerConnection was set",h),h.addStream(i),console.log("useEffect - localPeerConnection addStream(localStream)",h),h.addEventListener("icecandidate",(function(e){var n=e.candidate;if(n){new RTCIceCandidate(n);y.push(n),t.current.value=JSON.stringify(y)}})),h.addEventListener("iceconnectionstatechange",(function(e){console.log("on iceconnectionstatechange",e)})),h.addEventListener("addstream",(function(e){console.log("------------STREAM RECEIVED FROM OTHER PEER",e),g(e.stream)})),_)){h.createOffer({offerToReceiveVideo:1}).then((function(t){h.setLocalDescription(t),e.current.value=JSON.stringify(t)}))}}),[h]);var x=function(e){return T(Object(u.a)({},V,Object(s.a)({},e.target.name,e.target.value)))};return c.a.createElement("div",{className:w.a.wrapper},c.a.createElement("div",{className:w.a.left},c.a.createElement("h2",null,"My Stream"),c.a.createElement("video",{ref:n,className:w.a.video}),c.a.createElement("h2",null,"Remote Stream"),c.a.createElement("video",{ref:r,className:w.a.video})),c.a.createElement("div",{className:w.a.right},c.a.createElement("button",{onClick:function(){return N(!_)}},_?"Change to receiving Peer":"Change to Initializing Peer"),c.a.createElement("button",{onClick:function(){var e;return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d.a.awrap(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}));case 3:e=t.sent,m(e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error('stream couldnt be started via "startStream()"',t.t0);case 10:case"end":return t.stop()}}),null,null,[[0,7]])}},"Start My Stream"),c.a.createElement("button",{onClick:function(e){S(new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]})),console.log("creating localPeerConnection")}},"Init This Peer ".concat(_?"(Generates Offer)":"")),c.a.createElement("form",{onSubmit:function(t){t.preventDefault(),console.log("handle connect",V);var n=new RTCSessionDescription(JSON.parse(V.description));n&&(_&&"answer"===n.type?(console.log("handle connect - initiator - answer received"),h.setRemoteDescription(n)):_||"offer"!==n.type||(console.log("handle connect - !initiator - offer received - now an answer should be created!"),h.setRemoteDescription(n),h.createAnswer().then((function(t){h.setLocalDescription(t),e.current.value=JSON.stringify(t)}))))},className:[w.a.form,w.a.connectForm].join(" ")},c.a.createElement("fieldset",null,c.a.createElement("legend",null,"Connect"),c.a.createElement("textarea",{name:"description",id:"description",onChange:x,value:V.description,placeholder:"".concat(_?"Enter Answer":"Enter Offer"," of other Peer")}),c.a.createElement("button",{type:"submit"},"connect ",_?"":"(Generates Answer)"))),c.a.createElement("form",{onSubmit:function(e){e.preventDefault(),JSON.parse(V.remoteIceCandidates).forEach((function(e){console.log("addIceCandidate of remote peer:",e),h.addIceCandidate(e)}))},className:[w.a.form,w.a.connectForm].join(" ")},c.a.createElement("fieldset",null,c.a.createElement("legend",null,"Add the ICE Candidates of other peer"),c.a.createElement("textarea",{name:"remoteIceCandidates",id:"remoteIceCandidates",onChange:x,value:V.remoteIceCandidates,placeholder:"Enter the ICE Candidates of the other peer"}),c.a.createElement("button",{type:"submit"},"Add Candidates")))),c.a.createElement("div",{className:w.a.description},c.a.createElement("h2",{className:w.a.descriptionLabel},_?"Offer":"Answer"),c.a.createElement("div",null,"Once it appears, give the ",_?"Offer":"Answer"," below to the other peer"),c.a.createElement("textarea",{className:w.a.descriptionTextarea,ref:e,disabled:!0})),c.a.createElement("div",{className:w.a.iceCandidates},c.a.createElement("h1",{className:w.a.iceCandidatesLabel},"Ice Candidates"),c.a.createElement("div",null,"Once they appear give them to the other peer"),c.a.createElement("textarea",{className:w.a.iceCandidatesTextarea,ref:t,disabled:!0})))},P=function(){return c.a.createElement(l.a,null,c.a.createElement(l.b,{to:"/vanilla-webrtc"},"Vanilla WebRTC Test"),c.a.createElement(l.b,{to:"/simplepeer"},"Simple Peer Test"),c.a.createElement(l.b,{to:"/peerjs"},"Peer JS Test"),c.a.createElement(i.c,null,c.a.createElement(i.a,{path:"/simplepeer",component:v}),c.a.createElement(i.a,{path:"/peerJS",component:j}),c.a.createElement(i.a,{path:"/vanilla-webrtc",component:N})))};o.a.render(c.a.createElement(P,null),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.fb3c7510.chunk.js.map